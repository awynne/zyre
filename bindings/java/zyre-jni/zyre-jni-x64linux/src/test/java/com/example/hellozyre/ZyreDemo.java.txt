package com.example.hellozyre;

import android.app.Activity;
import android.os.Bundle;
import android.text.method.ScrollingMovementMethod;
import android.view.View;
import android.widget.Button;
import android.widget.TextView;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.zyre.Zyre;

public class ZyreDemo extends Activity {

    public static final String GROUP = "HelloZyreGroup";
    private Zyre zyre;
    static private RecvThread receiver;
    private Logger log = LoggerFactory.getLogger(ZyreDemo.class);
    private TextView ltv;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_zyre_demo);

        Button requestPipeButton = (Button) this.findViewById(R.id.shoutButton);
        ltv = (TextView) findViewById(R.id.logTextView);
        ltv.setMovementMethod(new ScrollingMovementMethod());

        requestPipeButton.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                TextView shoutTextView = (TextView) findViewById(R.id.shoutTextView);
                String msg = shoutTextView.getText().toString();
                log("shouting: " + msg);
                zyre.shout(GROUP, msg);
            }
        });
    }

    public void log(String msg) {
        log.info(msg);
        ltv.append(msg + "\n");
    }

    public void onStart() {
        super.onStart();

        if (receiver == null) {
            zyre = new Zyre();
            zyre.create();
            zyre.join(GROUP);

            receiver = new RecvThread();
            receiver.setUi(this);
            receiver.setZyre(zyre);
            receiver.setGroup(GROUP);
            receiver.start();
        }
    }

    public void onStop() {
        super.onStop();

        //receiver.interrupt();
        //zyre.destroy();
    }
}
